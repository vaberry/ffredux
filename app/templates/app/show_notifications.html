<script>

    function commentReplyToggle(parent_id) {
        const row = document.getElementById(parent_id);

        if (row.classList.contains('d-none')) {
            row.classList.remove('d-none');
        } else {
            row.classList.add('d-none');
        }
    }

    function showNotifications() {
        const container = document.getElementById('notification-container');

        if (container.classList.contains('d-none')) {
            container.classList.remove('d-none');
        } else {
            container.classList.add('d-none');
        }
    }

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    function removeNotification(removeNotificationURL, redirectURL) {
        const csrftoken = getCookie('csrftoken');
        let xmlhttp = new XMLHttpRequest();

        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == XMLHttpRequest.DONE) {
                if (xmlhttp.status == 200) {
                    window.location.replace(redirectURL);
                } else {
                    alert('There was an error');
                }
            }
        };

        xmlhttp.open("DELETE", removeNotificationURL, true);
        xmlhttp.setRequestHeader("X-CSRFToken", csrftoken);
        xmlhttp.send();
    }

    const scrollToBottom = (id) => {
        const element = document.getElementById(id);
        element.scrollTop = element.scrollHeight;
    }

</script>

    <div class="dropdown">
        {% if not notifications.count == 0 %}
            <span class="badge bg-primary notification-badge" onclick="showNotifications()">{{ notifications.count }}</span>
            <div class="dropdown-content d-none" id="notification-container">
                
                
                
        
                <div class="dropdown-item-parent">
                    <form method="POST" action="{% url 'clear-notifications' %}">
                        {% csrf_token %}
                        <br>
                        <br>
                        <span class="dropdown-item-close"><button style="border: none; margin-right: 135px;" type="submit"><h5>Clear all</h5></button></span>
                    </form>
                </div>
        
        
                {% for notification in notifications %}
                    {% if notification.post %}
                        {% if notification.notification_type == 1 %}
<!-- 
                        <div class="dropdown-list dropdown-menu dropdown-menu-right shadow animated--grow-in" aria-labelledby="alertsDropdown">
                            <h6 class="dropdown-header">
                              Alerts Center
                            </h6>
                            <a class="dropdown-item d-flex align-items-center" href="#">
                              <div class="mr-3">
                                <div class="icon-circle bg-primary">
                                  <i class="fas fa-file-alt text-white"></i>
                                </div>
                              </div>
                              <div>
                                <div class="small text-gray-500">December 12, 2019</div>
                                <span class="font-weight-bold">A new monthly report is ready to download!</span>
                              </div>
                            </a>
                          </div> -->



                        <div class="dropdown-item-parent">
                            <a href="{% url 'post-notification' notification.pk notification.post.pk %}">@{{ notification.from_user }} liked your post</a>
                            <span class="dropdown-item-close" onclick="removeNotification(`{% url 'notification-delete' notification.pk %}`, `{{ request.path }}`)">&times;</span>
                        </div>
                        {% elif notification.notification_type == 2 %}
                        <div class="dropdown-item-parent">
                            <a href="{% url 'post-notification' notification.pk notification.post.pk %}">@{{ notification.from_user }} commented on your post</a>
                            <span class="dropdown-item-close" onclick="removeNotification(`{% url 'notification-delete' notification.pk %}`, `{{ request.path }}`)">&times;</span>
                        </div>
                        {% endif %}
                    {% elif notification.comment %}
                        {% if notification.notification_type == 1 %}
                        <div class="dropdown-item-parent">
                            <a href="{% url 'post-notification' notification.pk notification.comment.post.pk %}">@{{ notification.from_user }} liked your comment</a>
                            <span class="dropdown-item-close" onclick="removeNotification(`{% url 'notification-delete' notification.pk %}`, `{{ request.path }}`)">&times;</span>
                        </div>
                        {% elif notification.notification_type == 2 %}
                        <div class="dropdown-item-parent">
                            <a href="{% url 'post-notification' notification.pk notification.comment.post.pk %}">@{{ notification.from_user }} replied to your comment</a>
                            <span class="dropdown-item-close" onclick="removeNotification(`{% url 'notification-delete' notification.pk %}`, `{{ request.path }}`)">&times;</span>
                        </div>
                        {% endif %}
        
                    {% elif notification.thread %}
                        {% if notification.notification_type == 3 %}
                        <div class="dropdown-item-parent">
                            <a href="{% url 'message-notification' notification.pk %}">@{{ notification.from_user }} has messaged you</a>
                            <span class="dropdown-item-close" onclick="removeNotification(`{% url 'notification-delete' notification.pk %}`, `{{ request.path }}`)">&times;</span>
                        </div>
                        {% endif %}
        
                    {% elif notification.trade %}
                        {% if notification.notification_type == 4 %}
                        <div class="dropdown-item-parent">
                            <a href="{% url 'trade-notification' notification.pk notification.trade.pk %}">@{{ notification.from_user }} has proposed a trade</a>
                            <span class="dropdown-item-close" onclick="removeNotification(`{% url 'notification-delete' notification.pk %}`, `{{ request.path }}`)">&times;</span>
                        </div>
                        {% elif notification.notification_type == 5 %}
                        <div class="dropdown-item-parent">
                            <a href="{% url 'trade-notification' notification.pk notification.trade.pk %}">@{{ notification.from_user }} has countered your trade</a>
                            <span class="dropdown-item-close" onclick="removeNotification(`{% url 'notification-delete' notification.pk %}`, `{{ request.path }}`)">&times;</span>
                        </div>
                        {% elif notification.notification_type == 6 %}
                        <div class="dropdown-item-parent">
                            <a href="{% url 'trade-notification' notification.pk notification.trade.pk %}">@{{ notification.from_user }} has accepted your trade</a>
                            <span class="dropdown-item-close" onclick="removeNotification(`{% url 'notification-delete' notification.pk %}`, `{{ request.path }}`)">&times;</span>
                        </div>
                        {% endif %}
                    {% else %}
        
        
                    {% endif %}
                {% endfor %}
            </div>
            {% else %}
                <span class="badge bg-secondary notification-badge" onclick="showNotifications()">{{ notifications.count }}</span>	
            {% endif %}
        </div>